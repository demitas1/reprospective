# Web UI 人間動作確認手順書

**対象:** Phase 2.2 Web UI (監視ディレクトリ設定画面)

**目的:** ブラウザ上でのWeb UI機能を手動で確認する

**所要時間:** 約15分

**テスト範囲:** 正常系のみ（ディレクトリの追加、編集、切り替え、削除）

---

## 前提条件

- プロジェクトのクローンと環境設定が完了している
- Docker Composeがインストールされている
- `.env` ファイルが設定されている

---

## 1. 環境起動

### 1-1. プロジェクトルートに移動

```bash
cd /path/to/reprospective
```

### 1-2. Docker環境を起動

```bash
./scripts/start.sh
```

**確認項目:**
- [ ] スクリプトがエラーなく完了する
- [ ] PostgreSQLコンテナが起動する
- [ ] API Gatewayコンテナが起動する（ヘルスチェック: healthy）
- [ ] Web UIコンテナが起動する

### 1-3. コンテナ状態確認

```bash
docker compose ps
```

**確認項目:**
- [ ] `reprospective-db` のSTATUSが `Up (healthy)`
- [ ] `reprospective-api` のSTATUSが `Up (healthy)`
- [ ] `reprospective-web` のSTATUSが `Up`

### 1-4. Web UIログ確認

```bash
docker compose logs web-ui | tail -20
```

**確認項目:**
- [ ] `VITE v7.1.12 ready in XXX ms` が表示される
- [ ] エラーメッセージが表示されない

---

## 2. Web UIアクセス確認

### 2-1. ブラウザでアクセス

ブラウザで以下のURLを開く:

```
http://localhost:3333
```

**確認項目:**
- [ ] ページが正常に表示される
- [ ] ヘッダーに「Reprospective」と表示される
- [ ] サブタイトルに「ファイルシステム監視設定」と表示される
- [ ] 「+ 新規追加」ボタンが表示される
- [ ] ディレクトリ一覧が表示される（既存データがある場合）

### 2-2. ローディング状態確認

初回アクセス時、データ取得中の表示を確認:

**確認項目:**
- [ ] ローディングスピナーが表示される（短時間）
- [ ] データ取得後、一覧が表示される

### 2-3. 空状態確認（既存データがない場合）

既存データがない場合:

**確認項目:**
- [ ] フォルダアイコンが表示される
- [ ] 「監視対象ディレクトリが登録されていません」メッセージが表示される
- [ ] 「上の「+ 新規追加」ボタンから最初のディレクトリを登録しましょう」メッセージが表示される

---

## 3. ディレクトリ追加機能テスト

### 3-1. 追加ダイアログを開く

1. 「+ 新規追加」ボタンをクリック

**確認項目:**
- [ ] ダイアログが開く
- [ ] タイトルに「監視対象ディレクトリを追加」と表示される
- [ ] 説明文に「新しい監視対象ディレクトリを登録します」と表示される
- [ ] 以下のフォーム項目が表示される:
  - [ ] ディレクトリパス（必須）
  - [ ] 表示名（任意）
  - [ ] 説明（任意）
  - [ ] 監視を有効化（スイッチ、デフォルトON）
- [ ] 「キャンセル」ボタンが表示される
- [ ] 「追加」ボタンが表示される

### 3-2. ディレクトリを追加（テスト1）

以下の情報を入力:

- **ディレクトリパス**: 実環境の既存ディレクトリパス（例: `/home/user/Documents`）
- **表示名**: `ドキュメント`
- **説明**: `テスト用ディレクトリ1`
- **監視を有効化**: ON（デフォルト）

**確認項目:**
- [ ] 各フィールドに入力できる
- [ ] スイッチをクリックしてON/OFF切り替えができる

「追加」ボタンをクリック:

**確認項目:**
- [ ] ダイアログが閉じる
- [ ] 一覧に新しいディレクトリカードが表示される
- [ ] カードに以下の情報が表示される:
  - [ ] ディレクトリパス
  - [ ] 表示名
  - [ ] 説明
  - [ ] 「監視中」バッジ（緑色）
  - [ ] トグルスイッチ（ON状態）
  - [ ] 「編集」ボタン
  - [ ] 「削除」ボタン
  - [ ] 最終更新日時

### 3-3. ディレクトリを追加（テスト2）

再度「+ 新規追加」ボタンをクリックし、別のディレクトリを追加:

- **ディレクトリパス**: 別の既存ディレクトリパス（例: `/home/user/projects`）
- **表示名**: `プロジェクト`
- **説明**: `テスト用ディレクトリ2`
- **監視を有効化**: OFF（スイッチをクリックして無効化）

「追加」ボタンをクリック:

**確認項目:**
- [ ] ダイアログが閉じる
- [ ] 一覧に2つのディレクトリカードが表示される
- [ ] 2つ目のカードに「無効」バッジ（グレー）が表示される
- [ ] 2つ目のカードのトグルスイッチがOFF状態

### 3-4. キャンセル動作確認

「+ 新規追加」ボタンをクリック:

1. 適当な情報を入力
2. 「キャンセル」ボタンをクリック

**確認項目:**
- [ ] ダイアログが閉じる
- [ ] 一覧に変化がない（追加されない）

---

## 4. ON/OFF切り替え機能テスト

### 4-1. 無効→有効に切り替え

2つ目のディレクトリ（現在OFF）のトグルスイッチをクリック:

**確認項目:**
- [ ] スイッチが即座にON状態に変わる（楽観的更新）
- [ ] バッジが「無効」→「監視中」に変わる
- [ ] バッジの色がグレー→緑色に変わる
- [ ] 切り替え中にスイッチが無効化される（二重クリック防止）

### 4-2. 有効→無効に切り替え

1つ目のディレクトリ（現在ON）のトグルスイッチをクリック:

**確認項目:**
- [ ] スイッチが即座にOFF状態に変わる
- [ ] バッジが「監視中」→「無効」に変わる
- [ ] バッジの色が緑色→グレーに変わる

### 4-3. 複数回切り替え

同じディレクトリのスイッチを数回クリック（ON→OFF→ON→OFF）:

**確認項目:**
- [ ] 各切り替えが正常に動作する
- [ ] UIが即座に反映される
- [ ] エラーが発生しない

---

## 5. ディレクトリ編集機能テスト

### 5-1. 編集ダイアログを開く

1つ目のディレクトリカードの「編集」ボタンをクリック:

**確認項目:**
- [ ] ダイアログが開く
- [ ] タイトルに「ディレクトリ情報を編集」と表示される
- [ ] 説明文に「監視対象ディレクトリの設定を変更します」と表示される
- [ ] 既存の情報がフォームにプリセットされている:
  - [ ] ディレクトリパス
  - [ ] 表示名
  - [ ] 説明
  - [ ] 監視を有効化スイッチ

### 5-2. 情報を編集

以下のように変更:

- **表示名**: `ドキュメント（更新）`
- **説明**: `説明を更新しました`

「更新」ボタンをクリック:

**確認項目:**
- [ ] ダイアログが閉じる
- [ ] カードの表示名が「ドキュメント（更新）」に変わる
- [ ] カードの説明が「説明を更新しました」に変わる
- [ ] 最終更新日時が更新される

### 5-3. 編集キャンセル

再度「編集」ボタンをクリック:

1. 表示名を変更
2. 「キャンセル」ボタンをクリック

**確認項目:**
- [ ] ダイアログが閉じる
- [ ] カードの情報が変更されない（元の状態を維持）

---

## 6. ディレクトリ削除機能テスト

### 6-1. 削除確認ダイアログを開く

2つ目のディレクトリカードの「削除」ボタンをクリック:

**確認項目:**
- [ ] ダイアログが開く
- [ ] タイトルに「ディレクトリを削除」と表示される（赤色）
- [ ] 警告アイコンが表示される
- [ ] 説明文に「この操作は取り消せません。本当に削除しますか？」と表示される
- [ ] 削除対象のディレクトリパスが赤枠内に表示される
- [ ] 削除対象の表示名が表示される
- [ ] 注意事項が表示される:
  - [ ] 「削除されるのはデータベース上の設定のみです。」
  - [ ] 「実際のディレクトリとファイルは削除されません。」
- [ ] 「キャンセル」ボタンが表示される
- [ ] 「削除」ボタンが表示される（赤色）

### 6-2. 削除を実行

「削除」ボタンをクリック:

**確認項目:**
- [ ] ダイアログが閉じる
- [ ] 一覧から該当のディレクトリカードが消える
- [ ] 残り1件のディレクトリのみが表示される

### 6-3. 削除キャンセル

残りのディレクトリの「削除」ボタンをクリック:

1. 削除確認ダイアログが表示される
2. 「キャンセル」ボタンをクリック

**確認項目:**
- [ ] ダイアログが閉じる
- [ ] ディレクトリが削除されない（一覧に残る）

---

## 7. 自動更新機能テスト（オプション）

### 7-1. 別のツールでデータを変更

別のターミナルで以下のコマンドを実行し、APIから直接ディレクトリを追加:

```bash
curl -X POST http://localhost:8800/api/v1/directories/ \
  -H "Content-Type: application/json" \
  -d '{
    "directory_path": "/tmp/auto-update-test",
    "enabled": true,
    "display_name": "自動更新テスト",
    "description": "自動更新確認用"
  }'
```

### 7-2. 自動更新を確認

ブラウザのWeb UIを表示したまま待機（最大30秒）:

**確認項目:**
- [ ] 30秒以内に新しいディレクトリが一覧に自動的に追加される
- [ ] ページリロードなしで表示が更新される

---

## 8. UI/UXの確認

### 8-1. レスポンシブデザイン

ブラウザウィンドウの幅を変更:

**確認項目:**
- [ ] カードのレイアウトが適切に調整される
- [ ] 小さい画面でも内容が読める
- [ ] スクロールバーが適切に表示される

### 8-2. ホバー効果

各ボタンにマウスカーソルを合わせる:

**確認項目:**
- [ ] ボタンの色が変わる（ホバー効果）
- [ ] カーソルがポインターに変わる

### 8-3. フォーカス状態

キーボードのTabキーでフォーカスを移動:

**確認項目:**
- [ ] フォーカスされた要素にリングが表示される
- [ ] Enterキーでボタンが押せる

---

## 9. エラー状態の確認（オプション）

### 9-1. APIサーバー停止時の挙動

別のターミナルでAPI Gatewayを停止:

```bash
docker compose stop api-gateway
```

ブラウザをリロード:

**確認項目:**
- [ ] エラーメッセージが表示される
- [ ] アプリケーションがクラッシュしない

API Gatewayを再起動:

```bash
docker compose start api-gateway
```

ブラウザをリロード:

**確認項目:**
- [ ] 正常に一覧が表示される

---

## 10. ホットリロード動作確認（オプション）

### 10-1. ソースコード変更

エディタで以下のファイルを開く:

```
services/web-ui/src/components/layout/Header.tsx
```

タイトル文字列を変更:

```typescript
// 変更前
<h1 className="text-2xl font-bold">Reprospective</h1>

// 変更後
<h1 className="text-2xl font-bold">Reprospective (テスト)</h1>
```

ファイルを保存:

**確認項目:**
- [ ] ブラウザが自動的にリロードされる（数秒以内）
- [ ] ヘッダーのタイトルが「Reprospective (テスト)」に変わる
- [ ] ページの状態（入力内容など）が維持される

変更を元に戻して保存:

**確認項目:**
- [ ] 再度自動リロードされる
- [ ] タイトルが元に戻る

---

## 11. 環境停止

### 11-1. Docker環境を停止

```bash
./scripts/stop.sh
```

**確認項目:**
- [ ] スクリプトがエラーなく完了する
- [ ] すべてのコンテナが停止する

### 11-2. 停止確認

```bash
docker compose ps
```

**確認項目:**
- [ ] すべてのコンテナのSTATUSが `Exit` または表示されない

---

## テスト結果記録

### テスト実施日時
- 日時: ____________________
- 実施者: ____________________

### 総合結果
- [ ] すべての確認項目が正常動作した
- [ ] 一部の確認項目で問題があった（詳細を備考欄に記載）
- [ ] 重大な問題があり、修正が必要

### 備考・問題点

```
（気づいた点、問題点、改善提案などを記載）






```

---

## トラブルシューティング

### ブラウザにアクセスできない

**症状:** http://localhost:3333 にアクセスできない

**確認手順:**
1. `docker compose ps` でweb-uiコンテナが起動しているか確認
2. `docker compose logs web-ui` でエラーログを確認
3. ポート3333が他のアプリケーションで使用されていないか確認
4. `.env` ファイルの `WEB_UI_PORT` を確認

### ディレクトリ一覧が表示されない

**症状:** ローディングが終わらない、または空の状態が続く

**確認手順:**
1. `docker compose ps` でapi-gatewayコンテナが `healthy` か確認
2. ブラウザの開発者ツール（F12）でコンソールエラーを確認
3. ネットワークタブでAPI呼び出しが失敗していないか確認
4. `curl http://localhost:8800/api/v1/directories/` でAPIが正常か確認

### 追加・編集・削除が失敗する

**症状:** 操作後にエラーメッセージが表示される

**確認手順:**
1. ブラウザの開発者ツールでエラー内容を確認
2. `docker compose logs api-gateway` でAPIサーバーのログを確認
3. PostgreSQLへの接続が正常か確認

---

## 参考情報

### アクセスURL一覧

- **Web UI**: http://localhost:3333
- **API Gateway**: http://localhost:8800
- **Swagger UI**: http://localhost:8800/docs
- **PostgreSQL**: localhost:6000

### ログ確認コマンド

```bash
# すべてのコンテナのログ
docker compose logs

# 特定のコンテナのログ
docker compose logs web-ui
docker compose logs api-gateway
docker compose logs database

# ログをリアルタイムで表示
docker compose logs -f web-ui
```

### データベース直接確認

```bash
# PostgreSQL接続
docker compose exec database psql -U reprospective -d reprospective_db

# ディレクトリ一覧表示
SELECT id, directory_path, enabled, display_name FROM monitored_directories;

# 終了
\q
```

---

**テスト完了**

すべての確認項目が正常に動作すれば、Web UI（Phase 2.2）の人間動作確認は完了です。
